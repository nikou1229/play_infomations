<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Scheduled Reveal</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    padding: 20px;
    max-width: 900px;
    margin: auto;
    background: url('image.jpg') no-repeat center center fixed;
    background-size: cover;
    color: #222;
    min-height: 100vh;
  }
  .overlay {
    background: rgba(255,255,255,0.75);
    padding: 20px;
    border-radius: 20px;
    box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    backdrop-filter: blur(6px);
  }
  .card {
    border: 1px solid #ddd;
    border-radius: 12px;
    padding: 16px;
    margin-bottom: 12px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.05);
    background: rgba(255,255,255,0.85);
    transition: all 0.3s ease;
  }
  .card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.1); }
  button {
    padding: 10px 14px;
    border-radius: 8px;
    border: none;
    background: #0b76ef;
    color: white;
    font-weight: 600;
    cursor: pointer;
    margin-top: 10px;
    transition: 0.2s;
  }
  button:hover { background: #005ed0; }
  input, textarea {
    padding: 8px;
    border-radius: 6px;
    border: 1px solid #ccc;
    width: 100%;
    margin-top: 6px;
  }
  h2 { margin-bottom: 8px; }
  .muted { color: #666; font-size: 13px; }
</style>
</head>
<body>
<div class="overlay">

<div id="role-selection" class="card">
  <div style="margin-bottom:16px;font-size:18px;font-weight:600;">まずあなたは管理者ですか？</div>
  <button id="choose-admin">はい（管理者）</button>
  <button id="choose-viewer" style="margin-left:8px;">いいえ（閲覧者）</button>
</div>

<div id="password-panel" class="card" style="display:none;">
  <div style="margin-bottom:10px;">管理者パスワードを入力してください</div>
  <input type="password" id="admin-pass-input" placeholder="パスワード">
  <button id="submit-pass">確認</button>
</div>

<div id="main-content" style="display:none;">
  <h1>情報公開所 by 堀野</h1>

  <div class="card" id="admin-panel">
    <label>テキスト</label>
    <textarea id="secret" rows="4" placeholder="ここにテキストを入力"></textarea>
    <label>画像・動画のURL（任意）</label>
    <input id="media-url" type="text" placeholder="例: https://example.com/image.jpg">
    <label>リンク（任意）</label>
    <input id="link-url" type="text" placeholder="例: https://example.com">
    <label>公開日時（ローカル）</label>
    <input id="dt" type="datetime-local">
    <div class="muted">※ブラウザのローカル時間で判定します</div>
    <button id="save">スケジュール保存</button>
  </div>

  <div class="card">
    <h3>スケジュール一覧</h3>
    <div id="list">（まだ登録されていません）</div>
  </div>
</div>

</div>
<script>
const ADMIN_PASS = 'nfwatty1229';
const roleSel = document.getElementById('role-selection');
const passPanel = document.getElementById('password-panel');
const main = document.getElementById('main-content');
const adminPanel = document.getElementById('admin-panel');
const listContainer = document.getElementById('list');
let storage = JSON.parse(localStorage.getItem('scheduled_reveals') || '[]');
let isAdmin = false;

function renderList() {
  listContainer.innerHTML = '';
  if (storage.length === 0) {
    listContainer.textContent = '（まだ登録されていません）';
    return;
  }

  const now = new Date();
  storage.forEach((e, i) => {
    const revealTime = new Date(e.when);
    const isRevealed = revealTime <= now;
    if (!isAdmin && !isRevealed) return;

    const div = document.createElement('div');
    div.className = 'card';
    let html = `<strong>公開日時:</strong> ${e.when}<br>`;
    html += e.text ? `<p>${e.text}</p>` : '';
    if (e.media) {
      if (e.media.match(/\.(mp4|webm|ogg)$/)) {
        html += `<video src='${e.media}' controls style='max-width:100%;margin-top:4px'></video>`;
      } else {
        html += `<img src='${e.media}' style='max-width:100%;margin-top:4px'>`;
      }
    }
    if (e.link) html += `<br><a href='${e.link}' target='_blank'>リンクはこちら</a>`;
    if (isAdmin) {
      html += `<br><button data-idx='${i}' class='del-btn' style='background:#e74c3c;'>削除</button>`;
    }
    div.innerHTML = html;
    listContainer.appendChild(div);
  });

  if (isAdmin) {
    document.querySelectorAll('.del-btn').forEach(btn => {
      btn.addEventListener('click', (ev) => {
        const idx = ev.target.dataset.idx;
        if (confirm('このスケジュールを削除しますか？')) {
          storage.splice(idx, 1);
          localStorage.setItem('scheduled_reveals', JSON.stringify(storage));
          renderList();
        }
      });
    });
  }

  if (listContainer.innerHTML === '') listContainer.textContent = '（まだ公開されていません）';
}

document.getElementById('save').addEventListener('click', () => {
  const text = document.getElementById('secret').value.trim();
  const media = document.getElementById('media-url').value.trim();
  const link = document.getElementById('link-url').value.trim();
  const dt = document.getElementById('dt').value;
  if (!dt) return alert('公開日時を指定してください');
  storage.push({ text, media, link, when: dt });
  localStorage.setItem('scheduled_reveals', JSON.stringify(storage));

  document.getElementById('secret').value = '';
  document.getElementById('media-url').value = '';
  document.getElementById('link-url').value = '';
  document.getElementById('dt').value = '';

  renderList();
});

document.getElementById('choose-admin').addEventListener('click', () => {
  roleSel.style.display = 'none';
  passPanel.style.display = 'block';
});
document.getElementById('choose-viewer').addEventListener('click', () => {
  isAdmin = false;
  roleSel.style.display = 'none';
  main.style.display = 'block';
  adminPanel.style.display = 'none';
  renderList();
});

document.getElementById('submit-pass').addEventListener('click', () => {
  const pass = document.getElementById('admin-pass-input').value;
  if (pass === ADMIN_PASS) {
    isAdmin = true;
    passPanel.style.display = 'none';
    main.style.display = 'block';
    adminPanel.style.display = 'block';
  } else {
    alert('パスワードが違います');
    isAdmin = false;
    passPanel.style.display = 'none';
    main.style.display = 'block';
    adminPanel.style.display = 'none';
  }
  renderList();
});

window.addEventListener('load', () => renderList());
</script>
</body>
</html>
